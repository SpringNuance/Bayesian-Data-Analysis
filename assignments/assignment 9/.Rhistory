ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1 | 2  |  3  |  4  |  5  |  6  \n")
cat("       ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3  |  4  |  5  |  6  \n")
cat("       ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3 |  4  |  5  |  6  \n")
cat("       ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3 |  4 |  5  |  6  \n")
cat("       ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3 |  4 |  5  |  6  \n")
paste("       ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3 |  4 |  5  |  6  \n")
paste("   ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3 |  4 |  5  |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4 |  5  |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  |  5  |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred7"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  | 5 |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, ypred7, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
ypred7 <- utility(draws = result_hierarchical$draws("ypred[7]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  | 5 |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_hierarchical <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 9", "model_hierarchical.stan")
model_hierarchical <- cmdstan_model(file_hierarchical)
model_hierarchical$compile(quiet = FALSE)
result_hierarchical <- model_hierarchical$sample(data = stan_data, show_messages=FALSE)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  | 5 |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
?sample
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_hierarchical <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 9", "model_hierarchical.stan")
model_hierarchical <- cmdstan_model(file_hierarchical)
model_hierarchical$compile(quiet = FALSE)
result_hierarchical <- model_hierarchical$sample(data = stan_data, chains=8, show_messages=FALSE)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  | 5 |  6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |   2  |  3  |  4  |  5  |   6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3  |  4  |  5  |   6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3  |  4   |  5  |   6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3  |  4   |  5   |   6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_hierarchical <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 9", "model_hierarchical.stan")
model_hierarchical <- cmdstan_model(file_hierarchical)
model_hierarchical$compile(quiet = FALSE)
result_hierarchical <- model_hierarchical$sample(data = stan_data, chains=4, show_messages=FALSE)
ypred1 <- utility(draws = result_hierarchical$draws("ypred[1]"))
ypred2 <- utility(draws = result_hierarchical$draws("ypred[2]"))
ypred3 <- utility(draws = result_hierarchical$draws("ypred[3]"))
ypred4 <- utility(draws = result_hierarchical$draws("ypred[4]"))
ypred5 <- utility(draws = result_hierarchical$draws("ypred[5]"))
ypred6 <- utility(draws = result_hierarchical$draws("ypred[6]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the six machines are")
cat("\nMachine    1  |  2  |  3  |  4   |  5   |   6  \n")
paste(" ",ypred1, ypred2, ypred3, ypred4, ypred5, ypred6, sep="  ")
ypred7 <- utility(draws = result_hierarchical$draws("ypred[7]"))
cat("\nThe chosen priors are from assignment 7 part 2d")
cat("\nmu0 ~ Normal(0, 10)")
cat("\nsigma0 ~ Gamma(1,1)")
cat("\nsigma ~ Gamma(1,1)")
cat("\nThe expected utility of the seventh machine is",ypred7)
"
data {
int<lower=0> N; // number of measurements per machine
int<lower=0> K; // number of machines
array[N] vector[K] y; // An array of vectors containing the table data
}
parameters {
vector[K] mu;
real sigma;
real mu_tau;
real sigma_tau;
real mu_ypred7;
}
model {
mu_tau ~ normal(0, 10);
sigma_tau ~ gamma(1, 1);
sigma ~ gamma(1, 1);
mu_ypred7 ~ normal(mu_tau, sigma_tau);
for (k in 1:K) {
mu[k] ~ normal(mu_tau, sigma_tau);
}
for (k in 1:K) {
y[, k] ~ normal(mu[k], sigma);
}
}
generated quantities {
array[K] real ypred;
for (k in 1:K) {
ypred[k] = normal_rng(mu[k] , sigma);
}
array[N] vector[K] log_likelihood; // An array of vectors of the log likelihood
for (i in 1:N) {
for (k in 1:K) {
log_likelihood[i][k] = normal_lpdf(y[i][k] | mu[k], sigma);
}
}
real ypred7 = normal_rng(mu_ypred7, sigma);
}
"
library(aaltobda)
library(ggplot2)
library(posterior)
theme_set(theme_minimal())
library(cmdstanr)
library(posterior)
library(bayesplot)
library(aaltobda)
library(loo)
data("factory")
library(aaltobda)
library(loo)
data("factory")
"
data {
int<lower=0> N; // number of measurements per machine
int<lower=0> K; // number of machines
array[N] vector[K] y; // An array of vectors containing the table data
}
parameters {
vector[K] mu;
vector<lower=0>[K] sigma;
}
model {
for (k in 1:K) {
mu[k] ~ normal(0, 10);
sigma[k] ~ gamma(1, 1);
}
for (k in 1:K) {
y[, k] ~ normal(mu[k], sigma[k]);
}
}
generated quantities {
array[K] real ypred;
array[N] vector[K] log_likelihood; // An array of vectors of the log likelihood
for (k in 1:K) {
ypred[k] = normal_rng(mu[k], sigma[k]);
}
for (i in 1:N) {
for (k in 1:K) {
log_likelihood[i][k] = normal_lpdf(y[i][k] | mu[k], sigma[k]);
}
}
}
"
"
data {
int<lower=0> N; // number of measurements per machine
int<lower=0> K; // number of machines
array[N] vector[K] y; // An array of vectors containing the table data
}
parameters {
real mu; // There is only a single mu for all machines
real<lower=0> sigma; // There is only a single sigma for all machines
}
model {
// priors
mu ~ normal(0, 10);
sigma ~ gamma(1, 1);
// likelihood
for (k in 1:K){
y[,k] ~ normal(mu, sigma);
}
}
generated quantities {
real ypred = normal_rng(mu, sigma);
array[N] vector[K] log_likelihood; // An array of vectors of the log likelihood
for (i in 1:N) {
for (k in 1:K) {
log_likelihood[i][k] = normal_lpdf(y[i][k] | mu, sigma);
}
}
}
"
"
data {
int<lower=0> N; // number of measurements per machine
int<lower=0> K; // number of machines
array[N] vector[K] y; // An array of vectors containing the table data
}
parameters {
vector[K] mu;
real sigma;
real mu_tau;
real sigma_tau;
real mu_ypred7;
}
model {
mu_tau ~ normal(0, 10);
sigma_tau ~ gamma(1, 1);
sigma ~ gamma(1, 1);
mu_ypred7 ~ normal(mu_tau, sigma_tau);
for (k in 1:K) {
mu[k] ~ normal(mu_tau, sigma_tau);
}
for (k in 1:K) {
y[, k] ~ normal(mu[k], sigma);
}
}
generated quantities {
array[K] real ypred;
for (k in 1:K) {
ypred[k] = normal_rng(mu[k] , sigma);
}
array[N] vector[K] log_likelihood; // An array of vectors of the log likelihood
for (i in 1:N) {
for (k in 1:K) {
log_likelihood[i][k] = normal_lpdf(y[i][k] | mu[k], sigma);
}
}
real ypred7 = normal_rng(mu_ypred7, sigma);
}
"
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_separate <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 8", "model_separate.stan")
model_separate <- cmdstan_model(file_separate)
model_separate$compile(quiet = FALSE)
result_separate <- model_separate$sample(data = stan_data, show_messages=FALSE)
file_pooled <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 8", "model_pooled.stan")
model_pooled <- cmdstan_model(file_pooled)
model_pooled$compile(quiet = FALSE)
result_pooled <- model_pooled$sample(data = stan_data, show_messages=FALSE)
file_hierarchical <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 8", "model_hierarchical.stan")
model_hierarchical <- cmdstan_model(file_hierarchical)
model_hierarchical$compile(quiet = FALSE)
result_hierarchical <- model_hierarchical$sample(data = stan_data, show_messages=FALSE)
loo_separate <- result_separate$loo(variables="log_likelihood",r_eff=TRUE)
cat("The PSIS-LOO elpd value of the separate model is\n")
print(loo_separate$estimates[1][1])
pareto_k <- loo_separate$diagnostics$pareto_k
cat("\nThe k-hat values of the separate model is\n")
print(loo_separate)
barplot(pareto_k, main = "(Separate model) k-hat diagnostics\n critical red line = 0.7", xlab = "k-hat values", ylab = "magnitude", ylim=c(0,1), col = "blue")
abline(h=0.7, col="red", lwd=2)
loo_pooled <- result_pooled$loo(variables="log_likelihood",r_eff=TRUE)
cat("The PSIS-LOO elpd value of the pooled model is\n")
print(loo_pooled$estimates[1][1])
pareto_k <- loo_pooled$diagnostics$pareto_k
cat("\nThe k-hat values of the pooled model is\n")
print(loo_pooled)
barplot(pareto_k, main = "(Pooled model) k-hat diagnostics\n critical red line = 0.7", xlab = "k-hat values", ylab = "magnitude", ylim=c(0,1), col = "blue")
abline(h=0.7, col="red", lwd=2)
loo_hierarchical <- result_hierarchical$loo(variables="log_likelihood",r_eff=TRUE)
cat("The PSIS-LOO elpd value of the hierarchical model is\n")
print(loo_hierarchical$estimates[1][1])
pareto_k <- loo_hierarchical$diagnostics$pareto_k
cat("\nThe k-hat values of the hierarchical model is\n")
print(loo_hierarchical)
barplot(pareto_k, main = "(Hierarchical model) k-hat diagnostics\n critical red line = 0.7", xlab = "k-hat values", ylab = "magnitude", ylim=c(0,1), col = "blue")
abline(h=0.7, col="red", lwd=2)
# A draws matrix of dimension S x N
log_likelihood_hierarchical <- result_hierarchical$draws("log_likelihood", format = "matrix")
S = nrow(log_likelihood_hierarchical) # Number of draws from the model
N = ncol(log_likelihood_hierarchical) # Number of observations
lppd = 0 # log pointwise predictive density
for (i in (1:N)){
col_sum = sum(exp(log_likelihood_hierarchical[, i]))
lppd = lppd + log((1/S)*col_sum)
}
# lppd_loocv
lppd_loocv = loo_hierarchical$estimates[1][1]
# Number of effective coefficients
p_eff = lppd - lppd_loocv
cat("The p_eff for the hierarchical model:", p_eff)
print(loo_compare(x = list(loo_separate=loo_separate, loo_pooled=loo_pooled, loo_hierarchical=loo_hierarchical)))
cat("\nThe PSIS-LOO elpd value of the separate model is\n")
print(loo_separate$estimates[1][1])
cat("\nThe PSIS-LOO elpd value of the pooled model is\n")
print(loo_pooled$estimates[1][1])
cat("\nThe PSIS-LOO elpd value of the hierarchical model is\n")
print(loo_hierarchical$estimates[1][1])
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_pooled_partd <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 7", "ex2_model_pooled_partd.stan")
model_pooled_partd <- cmdstan_model(file_pooled_partd)
model_pooled_partd$compile(quiet = FALSE)
result_pooled_partd <- model_pooled_partd$sample(data = stan_data, show_messages=FALSE)
ninetyPercentCredibleInterval(result_pooled_partd$draws("mu"), "pooled")
stan_data <- list(
y = factory,
N = nrow(factory),
K = ncol(factory)
)
file_separate <- file.path("C:/Users/nguye/Desktop/BDA/assignments/assignment 7", "ex2_model_separate.stan")
model_separate <- cmdstan_model(file_separate)
model_separate$compile(quiet = FALSE)
result_separate <- model_separate$sample(data = stan_data, refresh=1000)
#result_separate$summary()
